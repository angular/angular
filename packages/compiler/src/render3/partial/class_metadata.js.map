{"version":3,"file":"class_metadata.js","sourceRoot":"","sources":["class_metadata.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\nimport * as o from '../../output/output_ast';\nimport {\n  compileComponentMetadataAsyncResolver,\n  R3ClassMetadata,\n} from '../r3_class_metadata_compiler';\nimport {Identifiers as R3} from '../r3_identifiers';\nimport {R3DeferPerComponentDependency} from '../view/api';\nimport {DefinitionMap} from '../view/util';\n\nimport {R3DeclareClassMetadata, R3DeclareClassMetadataAsync} from './api';\n\n/**\n * Every time we make a breaking change to the declaration interface or partial-linker behavior, we\n * must update this constant to prevent old partial-linkers from incorrectly processing the\n * declaration.\n *\n * Do not include any prerelease in these versions as they are ignored.\n */\nconst MINIMUM_PARTIAL_LINKER_VERSION = '12.0.0';\n\n/**\n * Minimum version at which deferred blocks are supported in the linker.\n */\nconst MINIMUM_PARTIAL_LINKER_DEFER_SUPPORT_VERSION = '18.0.0';\n\nexport function compileDeclareClassMetadata(metadata: R3ClassMetadata): o.Expression {\n  const definitionMap = new DefinitionMap<R3DeclareClassMetadata>();\n  definitionMap.set('minVersion', o.literal(MINIMUM_PARTIAL_LINKER_VERSION));\n  definitionMap.set('version', o.literal('0.0.0-PLACEHOLDER'));\n  definitionMap.set('ngImport', o.importExpr(R3.core));\n  definitionMap.set('type', metadata.type);\n  definitionMap.set('decorators', metadata.decorators);\n  definitionMap.set('ctorParameters', metadata.ctorParameters);\n  definitionMap.set('propDecorators', metadata.propDecorators);\n\n  return o.importExpr(R3.declareClassMetadata).callFn([definitionMap.toLiteralMap()]);\n}\n\nexport function compileComponentDeclareClassMetadata(\n  metadata: R3ClassMetadata,\n  dependencies: R3DeferPerComponentDependency[] | null,\n): o.Expression {\n  if (dependencies === null || dependencies.length === 0) {\n    return compileDeclareClassMetadata(metadata);\n  }\n\n  const definitionMap = new DefinitionMap<R3DeclareClassMetadataAsync>();\n  const callbackReturnDefinitionMap = new DefinitionMap<R3ClassMetadata>();\n  callbackReturnDefinitionMap.set('decorators', metadata.decorators);\n  callbackReturnDefinitionMap.set('ctorParameters', metadata.ctorParameters ?? o.literal(null));\n  callbackReturnDefinitionMap.set('propDecorators', metadata.propDecorators ?? o.literal(null));\n\n  definitionMap.set('minVersion', o.literal(MINIMUM_PARTIAL_LINKER_DEFER_SUPPORT_VERSION));\n  definitionMap.set('version', o.literal('0.0.0-PLACEHOLDER'));\n  definitionMap.set('ngImport', o.importExpr(R3.core));\n  definitionMap.set('type', metadata.type);\n  definitionMap.set('resolveDeferredDeps', compileComponentMetadataAsyncResolver(dependencies));\n  definitionMap.set(\n    'resolveMetadata',\n    o.arrowFn(\n      dependencies.map((dep) => new o.FnParam(dep.symbolName, o.DYNAMIC_TYPE)),\n      callbackReturnDefinitionMap.toLiteralMap(),\n    ),\n  );\n\n  return o.importExpr(R3.declareClassMetadataAsync).callFn([definitionMap.toLiteralMap()]);\n}\n"]}