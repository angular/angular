{"version":3,"file":"signals-visualizer.js","sourceRoot":"","sources":["signals-visualizer.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {DebugSignalGraph, DebugSignalGraphNode} from '../../../../../../protocol';\nimport * as d3 from 'd3';\nimport {graphlib, render as dagreRender} from 'dagre-d3-es';\n\nconst KIND_CLASS_MAP: {[key: string]: string} = {\n  'signal': 'kind-signal',\n  'computed': 'kind-computed',\n  'effect': 'kind-effect',\n  'template': 'kind-template',\n  'linkedSignal': 'kind-linked-signal',\n};\n\nexport class SignalsGraphVisualizer {\n  private graph: graphlib.Graph;\n  private drender: ReturnType<typeof dagreRender>;\n\n  zoomController: d3.ZoomBehavior<SVGSVGElement, unknown>;\n\n  private animationMap: Map<string, number> = new Map();\n  private timeouts: Set<ReturnType<typeof setTimeout>> = new Set();\n  private nodeClickListeners: ((node: DebugSignalGraphNode) => void)[] = [];\n\n  constructor(private svg: SVGSVGElement) {\n    this.graph = new graphlib.Graph({directed: true});\n    this.graph.setGraph({});\n    this.graph.graph().rankdir = 'TB';\n    this.graph.graph().ranksep = 50;\n    this.graph.graph().nodesep = 5;\n\n    this.graph.setDefaultEdgeLabel(() => ({}));\n\n    this.drender = dagreRender();\n\n    const d3svg = d3.select(this.svg);\n    d3svg.attr('height', '100%').attr('width', '100%');\n    this.resize();\n\n    const g = d3svg.append('g');\n\n    this.zoomController = d3.zoom<SVGSVGElement, unknown>().scaleExtent([0.1, 2]);\n    this.zoomController.on('start zoom end', (e: {transform: number}) => {\n      g.attr('transform', e.transform);\n    });\n\n    d3svg.call(this.zoomController);\n  }\n\n  setSelected(selected: string | null) {\n    d3.select(this.svg)\n      .select('.output .nodes')\n      .selectAll<SVGGElement, string>('g.node')\n      .classed('selected', (d) => d === selected);\n  }\n\n  zoomScale(scale: number) {\n    if (this.zoomController) {\n      const svg = d3.select(this.svg);\n      this.zoomController.scaleTo(svg, scale);\n    }\n  }\n\n  cleanup(): void {\n    for (const timeout of this.timeouts) {\n      clearTimeout(timeout);\n    }\n  }\n\n  updateNodeAnimations(updatedNodes: string[], timeout: ReturnType<typeof setTimeout>) {\n    this.timeouts.delete(timeout);\n\n    for (const id of updatedNodes) {\n      const count = this.animationMap.get(id) ?? 0;\n      if (count > 0) {\n        this.animationMap.set(id, count - 1);\n      }\n    }\n\n    d3.select(this.svg)\n      .select('.output .nodes')\n      .selectAll<SVGGElement, string>('g.node')\n      .select('.label foreignObject .node-label')\n      .filter((d) => !this.animationMap.get(d))\n      .classed('animating', false);\n  }\n\n  reset() {\n    for (const node of this.graph.nodes()) {\n      this.graph.removeNode(node);\n    }\n    this.animationMap.clear();\n    this.cleanup();\n    this.timeouts.clear();\n  }\n\n  render(injectorGraph: DebugSignalGraph): void {\n    const updatedNodes: string[] = [];\n    let matchedNodeId = false;\n    for (const oldNode of this.graph.nodes()) {\n      if (!injectorGraph.nodes.find((n) => n.id == oldNode)) {\n        this.graph.removeNode(oldNode);\n        this.animationMap.delete(oldNode);\n      } else {\n        matchedNodeId = true;\n      }\n    }\n\n    const createNode = (node: DebugSignalGraphNode) => {\n      const outer = document.createElement('div');\n      outer.onclick = () => {\n        for (const cb of this.nodeClickListeners) {\n          cb(node);\n        }\n      };\n      outer.className = `node-label ${KIND_CLASS_MAP[node.kind]}`;\n      const header = document.createElement('div');\n      let label = node.label;\n      if (node.kind === 'effect') {\n        label = 'Effect';\n        header.classList.add('special');\n      }\n      if (!label) {\n        label = 'Unnamed';\n        header.classList.add('special');\n      }\n      header.classList.add('header');\n      header.textContent = label;\n      const body = document.createElement('div');\n      body.className = 'body';\n      body.textContent = getBodyText(node);\n      outer.appendChild(header);\n      outer.appendChild(body);\n      return outer;\n    };\n    for (const n of injectorGraph.nodes) {\n      const prev = this.graph.node(n.id);\n      if (prev) {\n        if (n.epoch !== prev.epoch) {\n          updatedNodes.push(n.id);\n          const count = this.animationMap.get(n.id) ?? 0;\n          this.animationMap.set(n.id, count + 1);\n          prev.epoch = n.epoch;\n          d3.select(prev.label).classed('animating', true);\n          const body = prev.label.querySelector('.body');\n          body.textContent = getBodyText(n);\n        }\n      } else {\n        this.graph.setNode(n.id, {\n          label: createNode(n),\n          labelType: 'html',\n          shape: 'rect',\n          padding: 0,\n          style: 'fill: none;',\n          epoch: n.epoch,\n          rx: 8,\n          ry: 8,\n        });\n      }\n    }\n\n    const timeout = setTimeout(() => {\n      this.updateNodeAnimations(updatedNodes, timeout);\n    }, 250);\n    this.timeouts.add(timeout);\n\n    const newEdgeIds = new Set();\n    for (const edge of injectorGraph.edges) {\n      const producerId = injectorGraph.nodes[edge.producer].id;\n      const consumerId = injectorGraph.nodes[edge.consumer].id;\n\n      const edgeId = `${btoa(producerId)}-${btoa(consumerId)}`;\n      newEdgeIds.add(edgeId);\n\n      if (!this.graph.hasEdge(producerId, consumerId, undefined)) {\n        this.graph.setEdge(producerId, consumerId, {\n          curve: d3.curveBasis,\n          style: 'stroke: gray; fill:none; stroke-width: 1px; stroke-dasharray: 5, 5;',\n          arrowheadStyle: 'fill: gray',\n        });\n      }\n    }\n    for (const edge of this.graph.edges()) {\n      if (!newEdgeIds.has(`${btoa(edge.v)}-${btoa(edge.w)}`)) {\n        this.graph.removeEdge(edge.v, edge.w, undefined);\n      }\n    }\n\n    if (matchedNodeId) {\n      this.graph.graph().transition = (selection: any) => {\n        return selection.transition().duration(500);\n      };\n    } else {\n      this.graph.graph().transition = undefined;\n    }\n\n    const g = d3.select(this.svg).select('g');\n\n    this.drender(g, this.graph);\n\n    // if there are no nodes, we reset the transform to 0\n    const {width, height} = this.graph.graph();\n    const xTransform = isFinite(width) ? -width / 2 : 0;\n    const yTransform = isFinite(height) ? -height / 2 : 0;\n    g.select('.output').attr('transform', `translate(${xTransform}, ${yTransform})`);\n  }\n\n  resize() {\n    const svg = d3.select(this.svg);\n    svg.attr('viewBox', [\n      -this.svg.clientWidth / 2,\n      -this.svg.clientHeight / 2,\n      this.svg.clientWidth,\n      this.svg.clientHeight,\n    ]);\n  }\n\n  /**\n   * Listen for node clicks.\n   *\n   * @param cb Callback/listener\n   * @returns An unlisten function\n   */\n  onNodeClick(cb: (node: DebugSignalGraphNode) => void): () => void {\n    this.nodeClickListeners.push(cb);\n\n    return () => {\n      const idx = this.nodeClickListeners.indexOf(cb);\n      if (idx > -1) {\n        this.nodeClickListeners.splice(idx, 1);\n      }\n    };\n  }\n}\n\nfunction getBodyText(node: DebugSignalGraphNode): string {\n  if (node.kind === 'signal' || node.kind === 'computed') {\n    return node.preview.preview;\n  }\n\n  if (node.kind === 'template') {\n    return '</>';\n  }\n\n  if (node.kind === 'effect') {\n    return '() => {}';\n  }\n\n  return '';\n}\n"]}