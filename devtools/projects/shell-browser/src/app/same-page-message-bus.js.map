{"version":3,"file":"same-page-message-bus.js","sourceRoot":"","sources":["same-page-message-bus.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {Events, MessageBus, Parameters} from '../../../protocol';\n\ntype AnyEventCallback<Ev> = <E extends keyof Ev>(topic: E, args: Parameters<Ev[E]>) => void;\n\ntype ListenerFn = (e: MessageEvent) => void;\n\nexport class SamePageMessageBus extends MessageBus<Events> {\n  private _listeners: ListenerFn[] = [];\n\n  constructor(\n    private _source: string,\n    private _destination: string,\n  ) {\n    super();\n  }\n\n  onAny(cb: AnyEventCallback<Events>): () => void {\n    const listener: ListenerFn = (e) => {\n      if (e.source !== window || !e.data || !e.data.topic || e.data.source !== this._destination) {\n        return;\n      }\n      cb(e.data.topic, e.data.args);\n    };\n    window.addEventListener('message', listener);\n    this._listeners.push(listener);\n    return () => {\n      this._listeners.splice(this._listeners.indexOf(listener), 1);\n      window.removeEventListener('message', listener);\n    };\n  }\n\n  override on<E extends keyof Events>(topic: E, cb: Events[E]): () => void {\n    const listener: ListenerFn = (e) => {\n      if (e.source !== window || !e.data || e.data.source !== this._destination || !e.data.topic) {\n        return;\n      }\n      if (e.data.topic === topic) {\n        (cb as any).apply(null, e.data.args);\n      }\n    };\n    window.addEventListener('message', listener);\n    this._listeners.push(listener);\n    return () => {\n      this._listeners.splice(this._listeners.indexOf(listener), 1);\n      window.removeEventListener('message', listener);\n    };\n  }\n\n  override once<E extends keyof Events>(topic: E, cb: Events[E]): void {\n    const listener: ListenerFn = (e) => {\n      if (e.source !== window || !e.data || e.data.source !== this._destination || !e.data.topic) {\n        return;\n      }\n      if (e.data.topic === topic) {\n        (cb as any).apply(null, e.data.args);\n      }\n      window.removeEventListener('message', listener);\n    };\n    window.addEventListener('message', listener);\n  }\n\n  override emit<E extends keyof Events>(topic: E, args?: Parameters<Events[E]>): boolean {\n    window.postMessage(\n      {\n        source: this._source,\n        topic,\n        args,\n        __ignore_ng_zone__: true,\n        __NG_DEVTOOLS_EVENT__: true,\n      },\n      '*',\n    );\n    return true;\n  }\n\n  override destroy(): void {\n    this._listeners.forEach((l) => window.removeEventListener('message', l));\n    this._listeners = [];\n  }\n}\n"]}